@using System.Security.Claims;
@model Group
<!DOCTYPE html>

<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/remixicon.css">
    <link href="/css/magnific-popup.min.css" rel="stylesheet" >
    <link href="/css/remixicon.css" rel="stylesheet">
    <link href="/css/all.css" rel="stylesheet" >
    <link href="/css/brands.css" rel="stylesheet" >
    <link href="/css/fontawesome.css" rel="stylesheet" >
    <link href="/css/solid.css" rel="stylesheet" >
    <link href="/css/bootstrap.css" rel="stylesheet" >    
    <script src="/js/bootstrap.bundle.js"></script>
</head>
<body>
    <div class="layout">
        
        <!-- Navigation -->
        <div class="navigation navbar border-end h-100 py-6">            
            <!-- Logo -->     
            <div class="avatar avatar-online avatar-lg">
                <img class="avatar-label bg-soft-info border border-primary" src="/img/@ViewBag.usrDetail" alt="">
            </div>                     
            <!-- Logo -->
            <!-- Nav -->
            <ul class="nav nav-pills" role="tablist">
                <!-- Create chat -->
                <li class="nav-item mt-xl-auto mb-5" role="presentation">
                    <a class="nav-link" data-bs-toggle="pill" href="#create-chat-tab" role="tab" aria-selected="false" title="Create chat">
                        <i class="ri-quill-pen-line"></i>
                    </a>
                </li>
                <!-- Create chat -->
                <!-- Friends -->
                <li class="nav-item mb-5" role="presentation">
                    <a class="nav-link" data-bs-toggle="pill" href="#friends-tab" role="tab" aria-selected="false" title="Friends">
                        <i class="ri-group-line"></i>
                    </a>
                </li>
                <!-- Friends -->
                <!-- Chats -->
                <li class="nav-item mb-5" role="presentation">
                    <a class="nav-link active" data-bs-toggle="pill" href="#chats-tab" role="tab" aria-selected="true" title="Chats">
                        <i class="ri-chat-3-line"></i>
                    </a>
                </li>
                <!-- Chats -->

                <!-- Settings -->
                <li class="nav-item mt-xl-auto mb-5" role="presentation">
                    <a class="nav-link" data-bs-toggle="pill" href="#settings-tab" role="tab" aria-selected="false" title="Settings">
                        <i class="ri-settings-4-line"></i>
                    </a>
                </li>
                <!-- Settings -->
                
                <!-- Avatar -->
                
                <!-- Avatar -->
            </ul>
            <!-- Nav -->
        </div>
        <!-- Navigation -->
        
    <!-- Sidebar -->
    <div class="sidebar border-end overflow-hidden h-100">
        <div class="tab-content h-100">
            <!-- Create Chat Tab -->
                <div class="tab-pane fade h-100" id="create-chat-tab" role="tabpanel">
                <div class="d-flex flex-column h-100">
                    <!-- Tab Header -->
                    <div class="tab-header d-flex align-items-center border-bottom">
                        <ul class="d-flex justify-content-between align-items-center list-unstyled w-100 mx-4 mb-0">
                            <!-- Title -->
                            <li>
                                <h3 class="mb-0">Create chat</h3>
                            </li>
                            <!-- Title -->

                            <!-- Buttons -->
                            <li>
                                <ul class="list-inline">
                                    <!-- Menu Button -->
                                    <li class="list-inline-item">
                                        <button type="button" class="navigation-toggle btn btn-secondary btn-icon d-xl-none">
                                            <i class="ri-menu-line"></i>
                                        </button>
                                    </li>
                                    <!-- Menu Button -->
                                </ul>
                            </li>
                            <!-- Buttons -->
                        </ul>
                    </div>
                    <!-- Tab Header -->

                    <!-- Search Input -->
                    
                    <!-- Search Input -->

                    <!-- Segmented Control -->
                    <div class="text-center mb-4">
                        <ul class="nav nav-pills nav-segmented" id="group-pills" role="tablist">
                            <!-- Direct Nav Item -->
                            <li class="nav-item" role="presentation">
                                <a name="btnCreat" class="nav-link active" id="pills-create-group-tab" data-bs-toggle="pill" href="#create-group-tab" role="tab" aria-controls="pills-create-group-tab" aria-selected="true">Group</a>
                            </li>
                            <!-- Direct Nav Item -->
                        
                            <!-- Group Nav Item -->
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="pills-select-member-tab" data-bs-toggle="pill" href="#select-member-tab" role="tab" aria-controls="pills-select-member-tab" aria-selected="false">Members</a>
                            </li>
                            <!-- Group Nav Item -->
                        </ul>
                    </div>
                    <!-- Segmented Control -->
                    
                    <!-- Tab Content -->
                    <div class="hide-scrollbar h-100">
                        <div class="tab-content m-4 mt-0">
                            <div class="tab-pane fade show active" id="create-group-tab" role="tabpanel">
                                <!-- Group Card -->
                                <form method="post" action="/chat/creategroup">
                                    <div class="card mb-3">
                                        <div class="card-body pt-11">
                                            <!-- Profile -->
                                            <div class="profile text-center">
                                                <div class="profile-content">
                                                    <div class="avatar avatar-lg">
                                                            
                                                        <span class="avatar-label bg-success text-white fs-3">                                                             
                                                                <img id="im" class="avatar-label bg-soft-info" src="/img/no-image.jpg" alt="Image description">   
                                                                <input asp-for="Avatar" value="" id="imgUrl" type="hidden">                                                                
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- Profile -->
                                            <!-- Group Name Input -->
                                            <div class="my-4">
                                                <div class="input-group">
                                                    <input type="text" asp-for="Convname" class="form-control form-control-lg form-control-solid" placeholder="Group name" aria-label="Group name">                                                    
                                                </div>
                                                    <span asp-validation-for="Convname" class="text-danger mb4"></span>
                                            </div>
                                            <!-- Group Name Input -->
                                            <!-- About Input -->
                                            <div class="mb-4">
                                                <div class="input-group">
                                                    <textarea asp-for="ConvDescrip" class="form-control form-control-lg form-control-solid" placeholder="Group description" rows="3"></textarea>
                                                </div>
                                            </div>
                                            <div class="my-4">
                                                <div class="input-group">
                                                    <input id="mlst" type="hidden" asp-for="Members" class="form-control form-control-lg form-control-solid" placeholder="Group name" aria-label="Group name">                                                        
                                                </div>
                                                    <span asp-validation-for="Members" class="text-danger "></span>
                                            </div>                                           
                                            <!-- About Input -->
                                            <div class="create-chat-footer border-top p-4">                                                
                                                <button class="btn btn-lg btn-primary w-100">Create Chat</button>
                                            </div>                                            
                                        </div>
                                            <input type="file" id="f" style="display:none;" />
                                    </div>
                                </form>
                                
                                <!-- Group Card -->
                                <!-- Title -->
                                <div class="d-flex align-items-center mx-4 mb-3">
                                    <small class="text-muted me-auto">Options</small>
                                </div>
                                <!-- Title -->                                    
                            </div>
                            <div class="tab-pane fade" id="select-member-tab" role="tabpanel">
                                <!-- Contact List A -->                             
                                @if (User.Identity.IsAuthenticated)
                                {
                                    if(ViewData["users"] != null)
                                    {
                                        foreach (var us in (IEnumerable<Member>)ViewData["users"])
                                        {
                                            <div>
                                                <!--  Friends List -->
                                                <ul class="list-unstyled">
                                                    <!-- Chat Link -->
                                                    <li class="card contact-item">
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <!-- Avatar -->
                                                                <div class="avatar avatar-online me-4">
                                                                    <img class="avatar-img" src="/img/@us.Avatar" alt="Image description">
                                                                </div>
                                                                <!-- Avatar -->
                                                                <!-- Content -->
                                                                <div class="flex-grow-1 overflow-hidden">
                                                                    <div class="d-flex align-items-center mb-1">
                                                                        <h5 class="text-truncate mb-0 me-auto">
                                                                            @us.Fullname
                                                                        </h5>
                                                                    </div>
                                                                    <div class="d-flex align-items-center">
                                                                        <div class="text-truncate me-auto">Online</div>
                                                                    </div>
                                                                </div>
                                                                <!-- Content -->
                                                                <!-- Check -->
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox" value="@us.UserId" name="chk" id="check-member-1">
                                                                </div>
                                                                <!-- Check -->
                                                            </div>
                                                        </div>
                                                    </li>
                                                    <!-- Chat Link -->
                                                </ul>
                                                <!--  Friends List -->
                                            </div>                                        
                                        }
                                    }
                                        
                                }
                                <!-- Contact List A -->
                            </div>
                        </div>
                    </div>
                    <!-- Tab Content -->
                    <!-- Create Chat Footer -->
                    
                    <!-- Create Chat Footer -->                    
                </div>
            </div>
            <!-- Create Chat Tab -->

            <!-- Friends Tab -->
            <div class="tab-pane fade h-100" id="friends-tab" role="tabpanel">
                <div class="d-flex flex-column h-100">
                    <!-- Tab Header -->
                    <div class="tab-header d-flex align-items-center border-bottom">
                        <ul class="d-flex justify-content-between align-items-center list-unstyled w-100 mx-4 mb-0">
                            <!-- Title -->
                            <li>
                                <h3 class="mb-0">Friends</h3>
                            </li>
                            <!-- Title -->

                            <!-- Buttons -->
                            <li>
                                <ul class="list-inline">
                                    <!-- Menu Button -->
                                    <li class="list-inline-item">
                                        <button type="button" class="navigation-toggle btn btn-secondary btn-icon d-xl-none">
                                            <i class="ri-menu-line"></i>
                                        </button>
                                    </li>
                                    <!-- Menu Button -->
                                </ul>
                            </li>
                            <!-- Buttons -->
                        </ul>
                    </div>
                    <!-- Tab Header -->
                    <!-- Tab Content -->
                    <div class="hide-scrollbar h-100">
                        <div class="m-4">
                            <ul class="list-unstyled">
                                @if(User.Identity.IsAuthenticated)
                                {          
                                    if(ViewData["users"] != null)
                                    {
                                        foreach (var us in (IEnumerable<Member>)ViewData["users"])
                                        {
                                            <!-- Chat Link -->
                                            <li id="rlst@(us.UserId)" class="card contact-item">
                                                    <a  class="contact-link"  asp-controller="chat" asp-action="create" asp-route-i="@us.UserId"></a>
                                                <div class="card-body">                                                
                                                    <div class="d-flex align-items-center">
                                                        <!-- Avatar -->
                                                        <div class="avatar @(((DateTime.Now-us.LastTimeActive).Value.TotalMinutes) > 5 ? "avatar-away" : "avatar-online") me-4">
                                                            <img class="avatar-img" src="/img/@us.Avatar" alt="Image description">
                                                        </div>
                                                        <!-- Avatar -->
                                                        <!-- Content -->
                                                        <div class="flex-grow-1 overflow-hidden">
                                                            <div class="d-flex align-items-center mb-1">
                                                                <h5 class="text-truncate mb-0 me-auto">
                                                                    @us.Fullname
                                                                </h5>
                                                            </div>
                                                            <div class="d-flex align-items-center">
                                                                    <div class="text-truncate me-auto">@(((DateTime.Now - us.LastTimeActive).Value.TotalMinutes) > 5 ? $"Away {(int)(DateTime.Now - us.LastTimeActive).Value.TotalMinutes} mins ago" : "Online")</div>
                                                            </div>
                                                        </div>
                                                        <!-- Content -->
                                                        <!-- Dropdown -->
                                                        <!-- Dropdown -->
                                                    </div>                                            
                                                </div>
                                            </li>
                                             <!-- Chat Link --> 
                                        }            
                                    }
                                                                                          
                                }
                            </ul>
                        </div>
                    </div>
                    <!-- Tab Content -->
                </div>
            </div>
            <!-- Friends Tab -->

            <!-- Chats Tab -->
                <div class="tab-pane fade show active h-100" id="chats-tab" role="tabpanel">
                <div class="d-flex flex-column h-100">
                    <!-- Tab Header -->
                    <div class="tab-header d-flex align-items-center border-bottom">
                        <ul class="d-flex justify-content-between align-items-center list-unstyled w-100 mx-4 mb-0">
                            <!-- Title -->
                            <li>
                                <h3 class="mb-0">Chats</h3>
                            </li>
                            <!-- Title -->

                            <!-- Buttons -->
                            <li>
                                <ul class="list-inline">
                                    <!-- Menu Button -->
                                    <li class="list-inline-item">
                                        <button type="button" class="navigation-toggle btn btn-secondary btn-icon d-xl-none">
                                            <i class="ri-menu-line"></i>
                                        </button>
                                    </li>
                                    <!-- Menu Button -->                                        
                                </ul>
                            </li>
                            <!-- Buttons -->
                        </ul>
                    </div>
                    <!-- Tab Header -->

                    
                    <!-- Segmented Control -->
                    <div class="text-center mb-3">
                        <ul class="nav nav-pills nav-segmented" id="pills-tab" role="tablist">
                            <!-- Direct Nav Item -->
                            <li class="nav-item" role="presentation">
                                    <a class="nav-link" id="pills-direct-tab" data-bs-toggle="pill" href="#direct-tab" role="tab" aria-controls="pills-direct-tab" aria-selected="false">Direct</a>
                            </li>
                            <!-- Direct Nav Item -->
                            <!-- Group Nav Item -->
                            <li class="nav-item" role="presentation">
                                <a class="nav-link" id="pills-group-tab" data-bs-toggle="pill" href="#groups-tab" role="tab" aria-controls="pills-group-tab" aria-selected="false">Groups</a>
                            </li>
                            <!-- Group Nav Item -->
                        </ul>
                    </div>
                    <!-- Segmented Control -->

                    <!-- Tab Content -->
                    <div class="hide-scrollbar h-100">
                        <div class="tab-content m-4 mt-1">
                            <!-- Direct Chats Tab -->
                            <div class="tab-pane fade show active" id="direct-tab" role="tabpanel">
                                <ul id="rsContact" class="list-unstyled js-contact-list mb-0">
                                    @if (User.Identity.IsAuthenticated)
                                    {
                                        if(ViewData["directChats"] != null)
                                        {
                                            foreach (var it in (IEnumerable<ConversationInfo>)ViewData["directChats"])
                                            {                                                
                                                        <!-- Chat Link 1 -->
                                                <li id="@it.ConvId" lt="@it.LastTimeActive" class="card contact-item mb-3">                                                
                                                    <a id="chatbox" class="contact-link" asp-controller="Chat" asp-action="Chat" asp-route-t="@it.ConvId"></a>
                                                    <div class="card-body">
                                                        <div class="d-flex align-items-center">
                                                            <!-- Avatar -->
                                                            <div class="avatar avatar-online me-4">
                                                                <img class="avatar-img" src="/img/@it.Avatar" alt="Image description">
                                                            </div>
                                                            <!-- Avatar -->
                                                            <!-- Content -->
                                                            <div class="flex-grow-1 overflow-hidden">
                                                                <div class="d-flex align-items-center mb-1">
                                                                    <h5 class="text-truncate mb-0 me-auto">@it.Convname</h5>
                                                                        <p id="ltChat@(it.ConvId)" class="small text-muted text-nowrap ms-4 mb-0">@(DateTime.Now.Date > it.MessageDate.Date ? $"{it.MessageDate.ToString("dd/MM hh:mm tt")}" : $"{it.MessageDate.ToString("hh:mm tt")}")</p>
                                                                </div>
                                                                <div  class="d-flex align-items-center">
                                                                        <div id="cntChat@(it.ConvId)" class="line-clamp me-auto">
                                                                        @it.Content
                                                                    </div>
                                                                    <span id="countChat@(it.ConvId)" class="badge rounded-pill bg-primary ms-2">@(it.CountMessage == 0 ? "" : $"{it.CountMessage}")</span>
                                                                </div>
                                                            </div>
                                                            <!-- Content -->
                                                        </div>
                                                    </div>
                                                        <!-- Chat Link 1 -->
                                                </li>                                                               
                                            }
                                        }                                            
                                    }                                  
                                </ul>
                            </div>
                            <!-- Direct Chats Tab -->

                            <!-- Group Chats Tab -->
                            <div class="tab-pane fade" id="groups-tab" role="tabpanel">
                                <ul id="rsGroup" class="list-unstyled js-contact-list mb-0">
                                    <!-- Chat Link 1 -->
                                    @if (User.Identity.IsAuthenticated)
                                    {
                                        if (ViewData["GroupChat"] != null)
                                        {
                                            foreach (var it in (IEnumerable<GroupInfo>)ViewData["GroupChat"])
                                            {
                                                <li class="card contact-item mb-3">
                                                        <a id="chatbox" class="contact-link" asp-controller="Chat" asp-action="Chat" asp-route-t="@it.ConvId"></a>
                                                        <div class="card-body">
                                                            <div class="d-flex align-items-center">
                                                                <!-- Avatar -->
                                                                <div class="avatar avatar-online me-4">
                                                                    <img class="avatar-img" src="/img/@it.Avatar" alt="Image description">
                                                                </div>
                                                                <!-- Avatar -->
                                                                <!-- Content -->
                                                                <div class="flex-grow-1 overflow-hidden">
                                                                    <div class="d-flex align-items-center mb-1">
                                                                        <h5 class="text-truncate mb-0 me-auto">@it.Convname</h5>
                                                                        <p id="ltChat@(it.ConvId)" class="small text-muted text-nowrap ms-4 mb-0">@(DateTime.Now.Date > it.MessageDate.Date ? $"{it.MessageDate.ToString("dd/MM hh:mm tt")}" : $"{it.MessageDate.ToString("hh:mm tt")}")</p>
                                                                    </div>
                                                                    <div class="d-flex align-items-center">
                                                                        <div id="cntChat@(it.ConvId)" class="line-clamp me-auto">
                                                                            @it.Content
                                                                        </div>
                                                                        <span id="countChat@(it.ConvId)" class="badge rounded-pill bg-primary ms-2">@(it.CountMessage == 0 ? "" : $"{it.CountMessage}")</span>
                                                                    </div>
                                                                </div>
                                                                <!-- Content -->
                                                            </div>
                                                        </div>
                                            <div class="card-footer d-flex align-items-center justify-content-between overflow-hidden">
                                              
                                                <p class="mb-0 small text-muted text-nowrap">@it.CountMember Members</p>
                                            </div>
                                                </li>
                                            }                                            
                                        }
                                    }
                                            <!-- Chat Link 1 -->
                                </ul>
                            </div>
                            <!-- Group Chats Tab -->
                        </div>
                    </div>
                    <!-- Tab Content -->
                </div>
            </div>
            <!-- Chats Tab -->
            
            <!-- Notification Tab -->
            
            <!-- Notification Tab -->

            <!-- Settings Tab -->
            <div class="tab-pane fade h-100" id="settings-tab" role="tabpanel">
                <div class="d-flex flex-column h-100">
                    <!-- Tab Header -->
                    <div class="tab-header d-flex align-items-center border-bottom">
                        <ul class="d-flex justify-content-between align-items-center list-unstyled w-100 mx-4 mb-0">
                            <!-- Title -->
                            <li>
                                <h3 class="mb-0">Settings</h3>
                            </li>
                            <!-- Title -->

                            <!-- Buttons -->
                            <li>
                                <ul class="list-inline">
                                    <!-- Menu Button -->
                                    <li class="list-inline-item">
                                        <button type="button" class="navigation-toggle btn btn-secondary btn-icon d-xl-none">
                                            <i class="ri-menu-line"></i>
                                        </button>
                                    </li>
                                    <!-- Menu Button -->
                                </ul>
                            </li>
                            <!-- Buttons -->
                        </ul>
                    </div>
                    <!-- Tab Header -->

                   

                    <!-- Tab Content -->
                    <div class="hide-scrollbar h-100">
                        <div class="m-4 mt-0">
                            <!-- Profile -->
                            <div class="card mb-3">
                                <div class="card-body">
                                    <div class="row align-items-center gx-4">
                                        <!-- Avatar -->
                                        <div class="col-auto">
                                            <div class="avatar avatar-online">
                                                    <img id="usrim" class="avatar-label bg-soft-info" src="/img/@ViewBag.usrDetail">
                                                    <input asp-for="Avatar" value="" id="usrimgUrl" type="hidden">
                                                    <input type="file" id="usrf" style="display:none;" />
                                            </div>
                                        </div>
                                        <!-- Avatar -->

                                        <!-- Content -->
                                        <div class="col">
                                                <h5 class="mb-1">@User.FindFirstValue(ClaimTypes.GivenName)</h5>
                                            <p class="text-muted mb-0">@User.FindFirstValue(ClaimTypes.Email)</p>
                                        </div>
                                        <!-- Content -->
                                    </div>
                                </div>
                            </div>
                            <!-- Profile -->

                            <!-- Account -->
                            <div class="mb-3">
                                <!-- Title -->
                                <div class="d-flex align-items-center mx-4 mb-3">
                                    <small class="text-muted me-auto">Acount</small>
                                </div>
                                <!-- Title -->

                               
                       
                            <!-- Account -->

                            <!-- Security -->
                            <div class="mb-3">
                                <!-- Title -->
                                <div class="d-flex align-items-center mx-4 mb-3">
                                    <small class="text-muted me-auto">Security</small>
                                </div>
                                <!-- Title -->

                                <!-- Accordion -->
                                <div class="card">
                                    <div class="card-body">
                                        <div class="accordion accordion-flush" id="accordion-security-settings">
                                            <div class="accordion-item">
                                                <div class="accordion-header" id="security-heading-1">
                                                    <div class="accordion-button collapsed p-0 pb-4" role="button" data-bs-toggle="collapse" data-bs-target="#security-collapse-1" aria-expanded="false" aria-controls="security-collapse-1">
                                                        <div>
                                                            <h5 class="mb-1">Password settings</h5>
                                                            <p class="text-muted mb-0">Manage your password</p>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div id="security-collapse-1" class="accordion-collapse collapse" aria-labelledby="security-heading-1">
                                                    <div class="accordion-body p-0 pb-4">
                                                        <!-- Current password -->
                                                        <div class="mb-4">
                                                            <div class="input-group">
                                                                <input id="cpwd" type="password" class="form-control form-control-lg form-control-solid" placeholder="Current password" aria-label="Current password">
                                                            </div>
                                                        </div>
                                                        <!-- Current password -->
                                                        <!-- New password -->
                                                        <div class="mb-4">
                                                            <div class="input-group">
                                                                <input id="npwd" type="password" class="form-control form-control-lg form-control-solid" placeholder="New password" aria-label="New password">
                                                            </div>
                                                        </div>
                                                        <!-- New password -->
                                                        <!-- Confirm password -->
                                                        <div class="mb-4">
                                                            <div class="input-group">
                                                                <input id="rpwd" type="password" class="form-control form-control-lg form-control-solid" placeholder="Confirm password" aria-label="Confirm password">                                                                        
                                                            </div>
                                                            <span style="display: none;" id="warnotice" class="text-danger field-validation-error"> Please confirm your new password</span>
                                                        </div>
                                                        <!-- Confirm password -->
                                                        <!-- Button -->
                                                        <button name="changepwd" class="btn btn-lg btn-primary w-100">Save</button>
                                                        <!-- Button -->
                                                    </div>                                                    
                                                </div>
                                            </div>
                                            
                                        </div>
                                    </div>
                                </div>
                                <!-- Accordion -->
                            </div>
                            <!-- Security -->

                           
                        </div>
                    </div>
                    <!-- Tab Content -->
                    <!-- Sign out Footer -->
                    <div class="invite-footer border-top p-4">
                            <a class="btn btn-lg btn-primary w-100" href="/auth/signout">Sign Out</a>
                    </div>
                    <!-- Sign out Footer -->
                </div>
            </div>
            <!-- Settings Tab -->

                

        </div>
        </div>
    </div>
        

    <!-- Sidebar -->

        @RenderBody()
        <script src="/js/jquery-3.6.0.min.js"></script>
        <script src="/js/bootstrap.bundle.js"></script>
        <script src="/js/jquery.magnific-popup.min.js"></script>
        <script>
                $(window).on('load', function(ev){
                    var v = $('#chatbox').attr('href');
                    $.ajax({
                        url: '@Url.Action("Index","Chat")',
                        data: {v: v},
                        success: function(result){
                            console.log('success');
                        },
                        error: function(){
                            console.log('error');
                        }
                    });
                });              
            
        </script>
        @RenderSection("Scripts",false)
    </div>
    <!--Scripts-->
    <link rel="stylesheet" href="/css/styles-light.min.css" />
    <script src="/js/jquery-3.6.0.min.js"></script>
    <script src="/js/signalr.min.js"></script>    
    <script src="/js/signalr.min.js"></script>
    <script src="/js/jquery-3.6.0.min.js"></script>

    <!--Scripts-->
</body>
</html>
<script type="text/javascript">    
        $('a[name=btnCreat]').click(function (ev) {
        var selectVa = $('input[name="chk"]:checked').map(function () {
            return $(this).val();
        }).get();
        console.log(selectVa);
        var u = '@User.FindFirstValue(ClaimTypes.NameIdentifier)';
        selectVa.push(u);
        var str = selectVa.join(';');
        $('input[id="mlst"]').val(str);
        console.log(str);
    });
    $(im).click(function () {
            f.click();
    });
    $(f).change(function () {
        var fd = new FormData();
        if (this.files[0].name.length > 15)  
        {
            var namefile = this.files[0].name;
            var ext = namefile.slice(namefile.lastIndexOf("."));
            const nm = Math.random().toString(36).slice(2, 10);
            namefile = nm + ext;
            fd.append('f', this.files[0], namefile);
        }
        fd.append('f', f.files[0]);
        console.log(fd);
        $.ajax({
            url: '/chat/upload',
            method: 'post',
            contentType: false,
            processData: false,
            data: fd,
            success: function (o) {
                $(im).attr('src', '/img/'+o.img);
                $('input[id="imgUrl"]').val(o.img);
            }
        });
    });
    $(usrim).click(function () {
        usrf.click();
    });
    $(usrf).change(function () {
        var fd = new FormData();        
        if (this.files[0].name.length > 15)  
        {
            var namefile = this.files[0].name;
            var ext = namefile.slice(namefile.lastIndexOf("."));
            const nm = Math.random().toString(36).slice(2, 10);
            namefile = nm + ext;
            fd.append('f', this.files[0], namefile);
        }
        fd.append('f', f.files[0]);
        $.ajax({
            url: '/chat/uploadusr',
            method: 'post',
            contentType: false,
            processData: false,
            data: fd,
            success: function (o) {
                $(usrim).attr('src', '/img/' + o.img);
                $('input[id="usrimgUrl"]').val(o.img);
            }
        });
    });
    $(window).on('load', function () {        
        $('input[id="mlst"]').val('@User.FindFirstValue(ClaimTypes.NameIdentifier)');
    });

</script>
